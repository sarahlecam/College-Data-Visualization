<!DOCTYPE html>
<html>
<head>
	<title>Project 2 - INFO/CS 3300</title>
	<link href="https://fonts.googleapis.com/css?family=Raleway:400,700italic" rel="stylesheet" type="text/css">
	<link href="style.css" rel="stylesheet" type="text/css">
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script src="locations.js"></script> <!-- www.findlatitudeandlongitude.com -->
</head>
<body>
	<nav id="nav">
		<span id="projectTitle">INFO/CS3300 - Project 2</span>
		<a href="javascript:void(0)" class="dropbtn" onclick="dropdownFunc()">Click to display a list of all colleges</a>
	    <div class="dropdown-content" id="myDropdown">
	    </div>
	</nav>

	<script>
	// first set up links in dropdown
	var dropdownDiv = document.getElementById("myDropdown");
	cities.forEach(function (obj) {
		dropdownDiv.innerHTML += "<a href='#' onClick='displayCollege("+JSON.stringify(obj)+")'>"+obj.Name+"</a>";
	});

	function displayCollege(d) {
		d3.select("#college").text(d.Name)
		.style("opacity", 0)
		.transition()
		.duration(1000)
		.style("opacity", 1);

		d3.select("#collegeLoc").text(d.City)
		.style("opacity", 0)
		.transition()
		.duration(1000)
		.style("opacity", 1);
	}

	/* When the user clicks on the button, 
	toggle between hiding and showing the dropdown content */
	function dropdownFunc() {
	    document.getElementById("myDropdown").classList.toggle("show");
	}

	// Close the dropdown if the user clicks outside of it
	window.onclick = function(e) {
	  if (!e.target.matches('.dropbtn')) {

	    var dropdowns = document.getElementsByClassName("dropdown-content");
	    for (var d = 0; d < dropdowns.length; d++) {
	      var openDropdown = dropdowns[d];
	      if (openDropdown.classList.contains('show')) {
	        openDropdown.classList.remove('show');
	      }
	    }
	  }
	}
	</script>

	<div id="map">
		<p id = "location">Click on a state to zoom in/zoom out on it, and click on any coordinate to learn more about the college in that city!</p>
		<script>
			// zoom map from http://bl.ocks.org/mbostock/2206590 and http://stackoverflow.com/questions/28823152/d3-js-map-zoom-behaviors-in-canvas-and-svg
			// set up map
			var mapWidth = 850, mapHeight = 460, centered;

			var projection = d3.geo.albersUsa()
			    .scale(900)
			    .translate([mapWidth / 2, mapHeight / 2]);

			var path = d3.geo.path()
			    .projection(projection);

			var svg = d3.select("#map").append("svg")
			    .attr("width", mapWidth)
			    .attr("height", mapHeight)
			    .style("background-color", "#d3d3d3")

			var g = svg.append("g");

			//bl.ocks.org/mbostock/raw/4090846/us.json
			d3.json("us.json", function(error, us) { 
			  if (error) throw error;

			  g.append("g")
			      .attr("id", "states")
			    .selectAll("path")
			      .data(topojson.feature(us, us.objects.states).features)
			    .enter().append("path")
			      .attr("d", path)
			      .on("click", clicked);

			  g.append("path")
			      .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
			      .attr("id", "state-borders")
			      .attr("d", path);
			});

			// svg.append("text")
			// 	.text("Click on a college to learn more about it")
			// 	.attr("id", "location")
			// 	.attr("x", mapWidth/2)
			// 	.attr("y", 15)
			// 	.attr("alignment-baseline", "central")
			// 	.attr("text-anchor", "middle");

			circles = svg.selectAll(".point").data(cities);

			function clicked(d) {
			  var x, y, k;
			  var largeRadius;
			  if (d && centered !== d) {
			    var centroid = path.centroid(d);
			    x = centroid[0];
			    y = centroid[1];
			    k = 3;
			    centered = d;
			    largeRadius = true;
			  } else {
			    x = mapWidth / 2;
			    y = mapHeight / 2;
			    k = 1;
			    centered = null;
			    largeRadius = false;
			  }

			  g.selectAll("path")
			      .classed("active", centered && function(d) { return d === centered; });

			  g.transition()
			      .duration(750)
			      .attr("transform", "translate(" + mapWidth / 2 + "," + mapHeight / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
			      .style("stroke-width", 1.5 / k + "px");

			  if (largeRadius) {
			  	circles.transition()
			  	  .duration(750)
			  	  .attr("transform", "translate(" + mapWidth / 2 + "," + mapHeight / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
			      .style("stroke-width", 1.5 / k + "px")
			      .attr("r", 0.8);
			  }

			  else {
			  	circles.transition()
			  	  .duration(750)
			  	  .attr("transform", "translate(" + mapWidth / 2 + "," + mapHeight / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
			      .style("stroke-width", 1.5 / k + "px")
			      .attr("r", 3);
			  }
			}
			// testing some random points
			// needed to set timeout so that the points don't load behind the map...
			// not sure why I need to do this
			function addCoords() {
				circles.enter().append("circle")
				.attr("class", "point")
				.attr("cx", function(d) { return projection([d.Longitude, d.Latitude])[0]; })
				.attr("cy", function(d) { return projection([d.Longitude, d.Latitude])[1]; })
				.attr("r", 3)
				.style("stroke", "black")
				.style("stroke-width", 1)
				.style("fill", "#ff6378")
				.on("mouseover", function (d) {
					d3.select("#location").text(d.City);
				})
				.on("mouseout", function (d) {
					d3.select("#location").text("Click on a state to zoom in/zoom out on it, and click on any coordinate to learn more about the college in that city!");
				})
				.on("click", function (d) {
					displayCollege(d);
				});
			};
			setTimeout(addCoords, 1000);
		</script>
	</div>

	<div id="info">
		<h3 id="college"></h3>
		<p id="collegeLoc"></p>
	</div>

</body>
</html>