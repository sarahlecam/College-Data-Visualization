<!DOCTYPE html>
<html>
<head>
	<title>Project 2 - INFO/CS 3300</title>
	<link href="https://fonts.googleapis.com/css?family=Raleway:400,700italic" rel="stylesheet" type="text/css">
	<link href="style.css" rel="stylesheet" type="text/css">
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<link href='https://fonts.googleapis.com/css?family=Montserrat+Subrayada' rel='stylesheet' type='text/css'>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script src="data.js"></script> <!-- www.findlatitudeandlongitude.com -->
	<script src="createJSONArray.js"></script>
</head>
<body>
	<div id="content">
	<div id="header">
		<h1>The Real Cost<br>of College<br></h1>
	</div>
	<div id="text">
		<p>
			In recent years, the cost of college of college has skyrocketed, leaving many qualified candidates unable to afford high tuition fees and the opportunity cost of forgoing employment.
		</p>
	</div>
	<div id="aggregate"></div>
	<div id="aggInfo">
		<p id="aggTitle"></p>
		<p id="aggValue"></p>
	</div>
	<nav id="nav">
		<!-- <span id="projectTitle">INFO/CS3300 - Project 2</span> -->
		<a href="javascript:void(0)" class="dropbtn" onclick="dropdownFunc()">Click to display a list of all colleges</a>
	    <div class="dropdown-content" id="myDropdown">
	    </div>
	</nav>

	<section>
		<div id="map">
			<p id = "location">Click on a state to zoom in/zoom out on it, and click on any coordinate to learn more about the top 50 college in that city!</p>
		</div>

		<div id="info">
			<div id="radiobuttons">
				<input type="radio" name="infotype" value="ringchart" onclick="chartCollegeData()" checked>View Chart Data
				<input type="radio" name="infotype" value="textdata" onclick="textCollegeData()">View Text Data
			</div>

			<br>

			<div id = "infotext">
				<h3 id="college"></h3>
				<p id="collegeLoc"></p>
				<p id = "rank"></p>
				<p id = "outofstatetuition"></p>
				<p id = "instatetuition"></p>
				<p id = "outofstatestudentbody"></p>
				<p id = "instatestudentbody"></p> 
				<p id = "totalstudentbody"></p>
				<p id = "finaid"></p>
				<p id = "avggrant"></p>
				<p id = "costliving"></p>
				<p id = "startingsalary"></p>
				<p id = "midsalary"></p>

				<p id="chartTitle"></p>
				<p id="chartValue"></p>
				<div id="chart"></div>
			</div>

		</div>
	</section>

	<script>

		var currentCollege = data[14]; // default is, you guessed it, Cornell!

		function displayCollege(obj) {
			currentCollege = obj;
			console.log(currentCollege);
			if (d3.select('input[name="infotype"]:checked').node().value == "ringchart") chartCollegeData();
			else textCollegeData();
		}

		// first set up links in dropdown
		var dropdownDiv = document.getElementById("myDropdown");
		data.forEach(function (obj) {
			dropdownDiv.innerHTML += "<a href='#' onClick='displayCollege("+JSON.stringify(obj)+")'>"+obj.Name+"</a>";
		});

		// function to show cornell text data
		function textCollegeData() {
			// first clear everything
			d3.select("#chartTitle").text("");
			d3.select("#chartValue").text("");
			d3.select("svg#ringchart").remove();
			d3.select("#college").text("");
			d3.select("#collegeLoc").text("");
			d3.select("#rank").text("");
			d3.select("#outofstatetuition").text("");
			d3.select("#instatetuition").text("");
			d3.select("#outofstatestudentbody").text("");
			d3.select("#instatestudentbody").text("");
			d3.select("#totalstudentbody").text("");
			d3.select("#finaid").text("");
			d3.select("#avggrant").text("");
			d3.select("#costliving").text("");
			d3.select("#startingsalary").text("");
			d3.select("#midsalary").text("");

			// figured out how to do transitions from lecture notes
			d3.select("#college").text(currentCollege.Name)
			.style("opacity", 0)
			.transition()
			.duration(1000)
			.style("opacity", 1);

			d3.select("#collegeLoc").text("Location: " + currentCollege.City)
			.style("opacity", 0)
			.transition()
			.duration(1000)
			.style("opacity", 1);

			d3.select("#rank").text("US News Ranking: " + currentCollege.Rank)
			.style("opacity", 0)
			.transition()
			.duration(1000)
			.style("opacity", 1);

			if (currentCollege.InStateTuition == 0) {
				d3.select("#outofstatetuition").text("Tuition: $" + currentCollege.OutOfStateTuition.toLocaleString())
				.style("opacity", 0)
				.transition()
				.duration(1000)
				.style("opacity", 1);

				d3.select("#instatetuition").text("")
				.style("opacity", 0)
				.transition()
				.duration(1000)
				.style("opacity", 1);
			}

			else if (currentCollege.InStateTuition != 0) {
				d3.select("#instatetuition").text("In state tuition: $" + currentCollege.InStateTuition.toLocaleString())
				.style("opacity", 0)
				.transition()
				.duration(1000)
				.style("opacity", 1);

				d3.select("#outofstatetuition").text("Out of state tuition: $" + currentCollege.OutOfStateTuition.toLocaleString())
				.style("opacity", 0)
				.transition()
				.duration(1000)
				.style("opacity", 1);
			}

			if (currentCollege.StudentBodyInState == 0) {
				d3.select("#instatestudentbody").text("")
				.style("opacity", 1)
				.transition()
				.duration(1000)
				.style("opacity", 0);

				d3.select("#outofstatestudentbody").text("Total student body: " + currentCollege.TotalStudentBody.toLocaleString())
				.style("opacity", 0)
				.transition()
				.duration(1000)
				.style("opacity", 1);

				d3.select("#totalstudentbody").text("")
				.style("opacity", 1)
				.transition()
				.duration(1000)
				.style("opacity", 0);
			}

			else if (currentCollege.StudentBodyInState != 0) {
				d3.select("#instatestudentbody").text("In state student body: " + currentCollege.StudentBodyInState.toLocaleString())
				.style("opacity", 0)
				.transition()
				.duration(1000)
				.style("opacity", 1);

				d3.select("#outofstatestudentbody").text("Out of state student body: " + currentCollege.StudentBodyOutOfState.toLocaleString())
				.style("opacity", 0)
				.transition()
				.duration(1000)
				.style("opacity", 1);

				d3.select("#totalstudentbody").text("Total student body: " + currentCollege.TotalStudentBody.toLocaleString())
				.style("opacity", 0)
				.transition()
				.duration(1000)
				.style("opacity", 1);

			}

			d3.select("#finaid").text("Average percentage on financial aid: " + currentCollege.AvgOnFinAid)
			.style("opacity", 0)
			.transition()
			.duration(1000)
			.style("opacity", 1);

			d3.select("#avggrant").text("Average grant amount given: $" + currentCollege.AvgGrantAmount.toLocaleString())
			.style("opacity", 0)
			.transition()
			.duration(1000)
			.style("opacity", 1);

			d3.select("#costliving").text("Average cost of living: $" + currentCollege.AvgCostLiving.toLocaleString())
			.style("opacity", 0)
			.transition()
			.duration(1000)
			.style("opacity", 1);

			d3.select("#startingsalary").text("Average starting salary: $" + currentCollege.StartingSalary.toLocaleString())
			.style("opacity", 0)
			.transition()
			.duration(1000)
			.style("opacity", 1);

			d3.select("#midsalary").text("Average mid-career salary: $" + currentCollege.MidSalary.toLocaleString())
			.style("opacity", 0)
			.transition()
			.duration(1000)
			.style("opacity", 1);
		}

		// function to show chart data
		function chartCollegeData() {
			// first clear everything
			d3.select("#chartTitle").text("");
			d3.select("#chartValue").text("");
			d3.select("svg#ringchart").remove();
			d3.select("#college").text("");
			d3.select("#collegeLoc").text("");
			d3.select("#rank").text("");
			d3.select("#outofstatetuition").text("");
			d3.select("#instatetuition").text("");
			d3.select("#outofstatestudentbody").text("");
			d3.select("#instatestudentbody").text("");
			d3.select("#totalstudentbody").text("");
			d3.select("#finaid").text("");
			d3.select("#avggrant").text("");
			d3.select("#costliving").text("");
			d3.select("#startingsalary").text("");
			d3.select("#midsalary").text("");

			d3.select("#chartValue").text("Rank: " + currentCollege.Rank);

			d3.select("#college").text(currentCollege.Name);

			d3.select("#collegeLoc").text("Location: " + currentCollege.City);

			// ring chart code: https://bl.ocks.org/mbostock/4348373

			var chartWidth = 25/100*window.innerWidth,
			    chartHeight = chartWidth,
			    radius = (Math.min(chartWidth, chartHeight) / 2) - 10;

			var svgRing = d3.select("#chart").append("svg")
				.attr("id", "ringchart")
			    .attr("width", chartWidth)
			    .attr("height", chartHeight)
			    .append("g")
			    .attr("transform", "translate(" + chartWidth / 2 + "," + (chartHeight / 2) + ")");

			var root = createArr(currentCollege);

			var formatNumber = d3.format(",d");

			var x = d3.scale.linear()
			    .range([0, 2 * Math.PI]);

			var y = d3.scale.sqrt()
			    .range([0, radius]);

			var color = d3.scale.category20c();
			// change the color scheme
			color.range()[0] = "#465a6d";
			color.range()[1] = "#63809c";
			color.range()[2] = "#a2b3c3";
			color.range()[3] = "#e0e6eb";
			color.range()[4] = "#c5e67f";
			color.range()[5] = "#e2f2bf";

			 partition = d3.layout.partition()
			    .value(function(d) { return d.size; });

			var arc = d3.svg.arc()
			    .startAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x))); })
			    .endAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x + d.dx))); })
			    .innerRadius(function(d) { return Math.max(0, y(d.y)); })
			    .outerRadius(function(d) { return Math.max(0, y(d.y + d.dy)); });

			  svgRing.selectAll("path")
			      .data(partition.nodes(root))
			    .enter().append("path")
			      .attr("d", arc)
			      .style("fill", function(d) { return color((d.children ? d : d.parent).name); })
			      .on("click", function(d){
			      	svgRing.transition()
				      .duration(750)
				      .tween("scale", function() {
				        var xd = d3.interpolate(x.domain(), [d.x, d.x + d.dx]),
				            yd = d3.interpolate(y.domain(), [d.y, 1]),
				            yr = d3.interpolate(y.range(), [d.y ? 20 : 0, radius]);
				        return function(t) { x.domain(xd(t)); y.domain(yd(t)).range(yr(t)); };
				      })
				    .selectAll("path")
				      .attrTween("d", function(d) { return function() { return arc(d); }; });
			      })
			      .on("mouseover", function(d) {
			     	if (d.displayNumber) d3.select("#chartValue").text(d.name + ": " +formatNumber(d.value));
			     	else d3.select("#chartValue").text(d.name);
			     });
			d3.select(self.frameElement).style("height", chartHeight + "px");

		}

		// drop down menu code: http://www.w3schools.com/howto/howto_js_dropdown.asp
		/* When the user clicks on the button, 
		toggle between hiding and showing the dropdown content */
		function dropdownFunc() {
		    document.getElementById("myDropdown").classList.toggle("show");
		}

		// Close the dropdown if the user clicks outside of it
		window.onclick = function(e) {
		  if (!e.target.matches('.dropbtn')) {

		    var dropdowns = document.getElementsByClassName("dropdown-content");
		    for (var d = 0; d < dropdowns.length; d++) {
		      var openDropdown = dropdowns[d];
		      if (openDropdown.classList.contains('show')) {
		        openDropdown.classList.remove('show');
		      }
		    }
		  }
		}

		// zoom map from http://bl.ocks.org/mbostock/2206590 and http://stackoverflow.com/questions/28823152/d3-js-map-zoom-behaviors-in-canvas-and-svg
		// set up map
		var mapWidth = 55/100*window.innerWidth, mapHeight = 0.62 * mapWidth, centered;

		var projection = d3.geo.albersUsa()
		    .scale(900)
		    .translate([mapWidth / 2, mapHeight / 2]);

		var path = d3.geo.path()
		    .projection(projection);

		var svg = d3.select("#map").append("svg")
		    .attr("width", mapWidth)
		    .attr("height", mapHeight)
		    // .style("background-color", "#d3d3d3")

		var g = svg.append("g");

		//map from bl.ocks.org/mbostock/raw/4090846/us.json
		d3.json("us.json", function(error, us) { 
		  if (error) throw error;

		  g.append("g")
		      .attr("id", "states")
		    .selectAll("path")
		      .data(topojson.feature(us, us.objects.states).features)
		    .enter().append("path")
		      .attr("d", path)
		      .on("click", clicked);

		  g.append("path")
		      .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
		      .attr("id", "state-borders")
		      .attr("d", path);
		});

		circles = svg.selectAll(".point").data(data);

		var loading = true;

		function clicked(d) {
			if (!loading) {
			  var x, y, k;
			  var largeRadius;
			  if (d && centered !== d) {
			    var centroid = path.centroid(d);
			    x = centroid[0];
			    y = centroid[1];
			    k = 3;
			    centered = d;
			    largeRadius = true;
			  } else {
			    x = mapWidth / 2;
			    y = mapHeight / 2;
			    k = 1;
			    centered = null;
			    largeRadius = false;
			  }

			  g.selectAll("path")
			      .classed("active", centered && function(d) { return d === centered; });

			  g.transition()
			      .duration(750)
			      .attr("transform", "translate(" + mapWidth / 2 + "," + mapHeight / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
			      .style("stroke-width", 1.5 / k + "px");

			  if (largeRadius) {
			  	circles.transition()
			  	  .duration(750)
			  	  .attr("transform", "translate(" + mapWidth / 2 + "," + mapHeight / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
			      .style("stroke-width", 1.5 / k + "px")
			      .attr("r", 1.3);
			  }

			  else {
			  	circles.transition()
			  	  .duration(750)
			  	  .attr("transform", "translate(" + mapWidth / 2 + "," + mapHeight / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
			      .style("stroke-width", 1.5 / k + "px")
			      .attr("r", 4);
			  }
			}
		}

		// needed to set timeout so that the points don't load behind the map...
		function addCoords() {
			circles.enter().append("circle")
			.attr("class", "point")
			.attr("cx", function(d) { return projection([d.Longitude, d.Latitude])[0]; })
			.attr("cy", function(d) { return projection([d.Longitude, d.Latitude])[1]; })
			.attr("r", 3)
			.style("stroke", "rgb(220,220,221)")
			.style("stroke-width", 0.5)
			.style("fill", "rgb(45,58,71)")
			.on("mouseover", function (d) {
				d3.select("#location").text(d.City);
			})
			.on("mouseout", function (d) {
				d3.select("#location").text("Click on a state to zoom in/zoom out on it, and click on any coordinate to learn more about the college in that city!");
			})
			.on("click", function (d) {
				displayCollege(d);
			});
			loading = false;
		};
		setTimeout(addCoords, 1000);
		displayCollege(currentCollege);
	</script>

	<div id="footer">
		<h2>INFO/CS 3300</h2>
		<h3>Project 2</h3>
		<h4>Ariel Gleitman&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;Hanna Ramsden&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;Sarah Le Cam</h4>
	</div>
	</div>
</body>
</html>